<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Invoice</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f9fafb;
        }
        @media print {
            .no-print {
                display: none !important;
            }
            body, html {
                background: white !important;
                margin: 0;
                padding: 0;
            }
            .print-container {
                box-shadow: none !important;
                border: none !important;
                margin: 0;
                padding: 0;
                width: 100% !important;
            }
            .invoice-content {
                background: white !important;
                color: black !important;
            }
            .bg-gray-800 {
                background: white !important;
                color: black !important;
                border-bottom: 2px solid #000 !important;
            }
            .bg-gray-50 {
                background: white !important;
                border: 1px solid #000 !important;
            }
            .bg-gray-100 {
                background: white !important;
                border-bottom: 1px solid #000 !important;
            }
            input, textarea {
                background: transparent !important;
                border: 1px solid #000 !important;
                color: black !important;
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
            }
            .item-amount {
                background: transparent !important;
                border: 1px solid #000 !important;
            }
        }
        input, textarea {
            outline: none !important;
        }
        input:focus, textarea:focus {
            ring: 1px solid #3b82f6 !important;
            border-color: #3b82f6 !important;
        }
        .invoice-content {
            background: white;
            color: black;
        }
        .tax-container {
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 10px;
        }
        .tax-field {
            flex: 1;
            min-width: 150px;
        }
        .total-tax-row {
            border-top: 1px solid #e5e7eb;
            border-bottom: 1px solid #e5e7eb;
            background-color: #f8fafc;
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen p-4">
    <div id="app" class="max-w-5xl mx-auto px-4 py-8">
        <h1 class="text-3xl font-bold text-gray-800 mb-6">Invoice</h1>
        
        <div class="invoice-content rounded-lg shadow-md overflow-hidden print-container">
            <!-- Header with buttons -->
            <div class="p-6 bg-gray-800 text-white flex justify-between items-center no-print">
                <h2 class="text-xl font-semibold">New Invoice</h2>
                <div class="flex gap-3">
                    <button id="printBtn" class="flex items-center gap-1 bg-blue-500 hover:bg-blue-600 text-white py-2 px-4 rounded transition-colors">
                        <i data-lucide="printer" class="w-4 h-4"></i>
                        <span>Print</span>
                    </button>
                    <button id="downloadBtn" class="flex items-center gap-1 bg-green-500 hover:bg-green-600 text-white py-2 px-4 rounded transition-colors">
                        <i data-lucide="download" class="w-4 h-4"></i>
                        <span>Download</span>
                    </button>
                    <button id="saveBtn" class="flex items-center gap-1 bg-purple-500 hover:bg-purple-600 text-white py-2 px-4 rounded transition-colors">
                        <i data-lucide="save" class="w-4 h-4"></i>
                        <span>Save</span>
                    </button>
                    <button id="clearBtn" class="flex items-center gap-1 bg-red-500 hover:bg-red-600 text-white py-2 px-4 rounded transition-colors">
                        <i data-lucide="trash-2" class="w-4 h-4"></i>
                        <span>Clear Form</span>
                    </button>
                </div>
            </div>
            
            <div class="p-6">
                <!-- Invoice Header Section -->
                <div class="mb-8">
                    <div class="flex justify-between flex-wrap gap-6">
                        <!-- From Section -->
                        <div class="w-full md:w-[48%]">
                            <h3 class="text-lg font-semibold text-gray-700 mb-3">From</h3>
                            <div class="space-y-3">
                                <div>
                                    <label class="block text-sm font-medium text-gray-600 mb-1">Your Business Name</label>
                                    <input type="text" id="fromName" value="ABC Company" class="w-full p-2 border border-gray-300 rounded">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-600 mb-1">Email</label>
                                    <input type="email" id="fromEmail" value="abc@mail.com" class="w-full p-2 border border-gray-300 rounded">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-600 mb-1">Mobile Number</label>
                                    <input type="tel" id="fromMobile" value="+91 9876543210" class="w-full p-2 border border-gray-300 rounded">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-600 mb-1">Address</label>
                                    <textarea id="fromAddress" class="w-full p-2 border border-gray-300 rounded" rows="2">123 Business St, City, Country</textarea>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Bill To Section -->
                        <div class="w-full md:w-[48%]">
                            <h3 class="text-lg font-semibold text-gray-700 mb-3">Bill To</h3>
                            <div class="space-y-3">
                                <div>
                                    <label class="block text-sm font-medium text-gray-600 mb-1">Client Name</label>
                                    <input type="text" id="toName" value="ABC Company" class="w-full p-2 border border-gray-300 rounded">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-600 mb-1">Email</label>
                                    <input type="email" id="toEmail" value="abc@email.com" class="w-full p-2 border border-gray-300 rounded">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-600 mb-1">Mobile Number</label>
                                    <input type="tel" id="toMobile" value="+91 1234567890" class="w-full p-2 border border-gray-300 rounded">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-600 mb-1">Address</label>
                                    <textarea id="toAddress" class="w-full p-2 border border-gray-300 rounded" rows="2">Delhi</textarea>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mt-6 flex justify-between flex-wrap gap-4">
                        <div class="w-full md:w-auto">
                            <label class="block text-sm font-medium text-gray-600 mb-1">Invoice Number</label>
                            <input type="text" id="invoiceNumber" value="INV-2025-7339" class="w-full md:w-48 p-2 border border-gray-300 rounded">
                        </div>
                        <div class="w-full md:w-auto">
                            <label class="block text-sm font-medium text-gray-600 mb-1">Issue Date</label>
                            <input type="date" id="issueDate" value="2025-09-06" class="w-full md:w-48 p-2 border border-gray-300 rounded">
                        </div>
                        <div class="w-full md:w-auto">
                            <label class="block text-sm font-medium text-gray-600 mb-1">Due Date</label>
                            <input type="date" id="dueDate" class="w-full md:w-48 p-2 border border-gray-300 rounded">
                        </div>
                    </div>
                </div>
                
                <!-- Invoice Items Section -->
                <div class="mb-8">
                    <h3 class="text-lg font-semibold text-gray-700 mb-3">Items</h3>
                    <div class="overflow-x-auto">
                        <table class="w-full border-collapse">
                            <thead>
                                <tr class="bg-gray-100">
                                    <th class="p-3 text-left text-sm font-semibold text-gray-600 w-[40%]">Description</th>
                                    <th class="p-3 text-right text-sm font-semibold text-gray-600">Quantity</th>
                                    <th class="p-3 text-right text-sm font-semibold text-gray-600">Price</th>
                                    <th class="p-3 text-right text-sm font-semibold text-gray-600">Amount</th>
                                    <th class="p-3 w-12 no-print"></th>
                                </tr>
                            </thead>
                            <tbody id="itemsTableBody">
                                <!-- Items will be added here dynamically -->
                            </tbody>
                        </table>
                    </div>
                    <div class="mt-4 no-print">
                        <button id="addItemBtn" class="flex items-center gap-1 text-blue-600 hover:text-blue-800 font-medium transition-colors">
                            <i data-lucide="plus" class="w-4 h-4"></i>
                            <span>Add Item</span>
                        </button>
                    </div>
                </div>
                
                <!-- Invoice Summary Section -->
                <div class="flex flex-col md:flex-row gap-8">
                    <div class="w-full md:w-1/2 order-2 md:order-1">
                        <h3 class="text-lg font-semibold text-gray-700 mb-3">Notes</h3>
                        <textarea id="notes" class="w-full p-3 border border-gray-300 rounded h-32" placeholder="Payment terms, delivery information, or any other notes...">Thank you for your business!</textarea>
                    </div>
                    <div class="w-full md:w-1/2 order-1 md:order-2">
                        <div class="bg-gray-50 p-4 rounded border border-gray-200">
                            <div class="flex justify-between py-2">
                                <span class="text-gray-600">Subtotal:</span>
                                <span id="subtotal" class="font-medium">₹0.00</span>
                            </div>
                            
                            <div class="tax-container">
                                <div class="tax-field">
                                    <div class="flex justify-between items-center py-2">
                                        <div class="flex items-center gap-2">
                                            <span class="text-gray-600">SGST:</span>
                                            <input type="number" id="sgstRate" min="0" max="100" step="0.1" value="9" class="w-16 p-1 border border-gray-300 rounded text-right">
                                            <span class="text-gray-600">%</span>
                                        </div>
                                        <span id="sgstAmount" class="font-medium">₹0.00</span>
                                    </div>
                                </div>
                                <div class="tax-field">
                                    <div class="flex justify-between items-center py-2">
                                        <div class="flex items-center gap-2">
                                            <span class="text-gray-600">CGST:</span>
                                            <input type="number" id="cgstRate" min="0" max="100" step="0.1" value="9" class="w-16 p-1 border border-gray-300 rounded text-right">
                                            <span class="text-gray-600">%</span>
                                        </div>
                                        <span id="cgstAmount" class="font-medium">₹0.00</span>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Total Tax Row -->
                            <div class="flex justify-between py-2 total-tax-row">
                                <span class="text-gray-600 font-medium">Total Tax (SGST + CGST):</span>
                                <span id="totalTax" class="font-medium">₹0.00</span>
                            </div>
                            
                            <div class="flex justify-between py-3 border-t border-gray-300 mt-2">
                                <span class="text-lg font-semibold">Total:</span>
                                <span id="total" class="text-lg font-bold">₹0.00</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Initialize Lucide icons
        lucide.createIcons();
        
        // Store original values for clear form functionality
        const originalValues = {
            fromName: 'ABC Company',
            fromEmail: 'abc@email.com',
            fromMobile: '+91 9876543210',
            fromAddress: '123 Business St, City, Country',
            toName: 'XYZ Company',
            toEmail: 'abc@email.com',
            toMobile: '+91 1234567890',
            toAddress: 'Delhi',
            notes: 'Thank you for your business!',
            sgstRate: 9,
            cgstRate: 9,
            items: [
                { description: 'Laptop', quantity: 1, price: 25 },
                { description: 'Mouse', quantity: 2, price: 10 }
            ]
        };
        
        // Generate random invoice number and set dates
        document.addEventListener('DOMContentLoaded', function() {
            const now = new Date();
            const dueDate = new Date(now.getTime() + 30 * 24 * 60 * 60 * 1000);
            
            document.getElementById('invoiceNumber').value = `INV-${now.getFullYear()}-${String(Math.floor(1000 + Math.random() * 9000))}`;
            document.getElementById('issueDate').value = now.toISOString().split('T')[0];
            document.getElementById('dueDate').value = dueDate.toISOString().split('T')[0];
            
            // Add initial items based on the example
            addNewItem('Laptop', 1, 25);
            addNewItem('Mouse', 2, 10);
            
            // Calculate initial invoice
            calculateInvoice();
        });
        
        // Invoice data structure
        let invoiceData = {
            items: [],
            sgstRate: 9,
            cgstRate: 9,
            subtotal: 0,
            sgstAmount: 0,
            cgstAmount: 0,
            totalTax: 0,
            total: 0
        };
        
        // Add new item row with optional values
        function addNewItem(description = '', quantity = 1, price = 0) {
            const itemsTableBody = document.getElementById('itemsTableBody');
            const itemId = Date.now().toString();
            const amount = quantity * price;
            
            const newRow = document.createElement('tr');
            newRow.className = 'border-b border-gray-200';
            newRow.innerHTML = `
                <td class="p-3">
                    <input type="text" data-id="${itemId}" data-field="description" value="${description}" placeholder="Item description" class="w-full p-2 border border-gray-300 rounded item-input">
                </td>
                <td class="p-3">
                    <input type="number" data-id="${itemId}" data-field="quantity" min="1" value="${quantity}" class="w-full p-2 border border-gray-300 rounded text-right item-input">
                </td>
                <td class="p-3">
                    <input type="number" data-id="${itemId}" data-field="price" min="0" step="0.01" value="${price}" class="w-full p-2 border border-gray-300 rounded text-right item-input">
                </td>
                <td class="p-3 text-right">
                    <span data-id="${itemId}" class="inline-block min-w-20 p-2 bg-gray-50 rounded text-right item-amount">₹${amount.toFixed(2)}</span>
                </td>
                <td class="p-3 no-print">
                    <button data-id="${itemId}" class="p-2 text-red-500 hover:text-red-700 rounded-full hover:bg-red-50 delete-item-btn ${invoiceData.items.length === 0 ? 'opacity-50 cursor-not-allowed' : ''}">
                        <i data-lucide="trash-2" class="w-4 h-4"></i>
                    </button>
                </td>
            `;
            itemsTableBody.appendChild(newRow);
            
            // Add to data structure
            invoiceData.items.push({
                id: itemId,
                description: description,
                quantity: quantity,
                price: price,
                amount: amount
            });
            
            // Reinitialize icons and event listeners
            lucide.createIcons();
            attachItemEventListeners();
            
            // Enable delete buttons if we have more than one item
            if (invoiceData.items.length > 1) {
                document.querySelectorAll('.delete-item-btn').forEach(btn => {
                    btn.classList.remove('opacity-50', 'cursor-not-allowed');
                });
            }
        }
        
        // Delete item
        function deleteItem(itemId) {
            if (invoiceData.items.length <= 1) return; // Don't delete the last item
            
            // Remove from UI
            document.querySelectorAll(`[data-id="${itemId}"]`).forEach(el => {
                el.closest('tr').remove();
            });
            
            // Remove from data structure
            invoiceData.items = invoiceData.items.filter(item => item.id !== itemId);
            
            // Recalculate invoice
            calculateInvoice();
            
            // If only one item left, disable delete buttons
            if (invoiceData.items.length === 1) {
                document.querySelectorAll('.delete-item-btn').forEach(btn => {
                    btn.classList.add('opacity-50', 'cursor-not-allowed');
                });
            }
        }
        
        // Update item field
        function updateItem(itemId, field, value) {
            const item = invoiceData.items.find(item => item.id === itemId);
            if (!item) return;
            
            if (field === 'quantity' || field === 'price') {
                value = parseFloat(value) || 0;
            }
            
            item[field] = value;
            
            // If quantity or price changed, recalculate amount
            if (field === 'quantity' || field === 'price') {
                item.amount = item.quantity * item.price;
                document.querySelector(`.item-amount[data-id="${itemId}"]`).textContent = `₹${item.amount.toFixed(2)}`;
            }
            
            // Recalculate invoice
            calculateInvoice();
        }
        
        // Calculate invoice totals
        function calculateInvoice() {
            // Get tax rates
            invoiceData.sgstRate = parseFloat(document.getElementById('sgstRate').value) || 0;
            invoiceData.cgstRate = parseFloat(document.getElementById('cgstRate').value) || 0;
            
            // Calculate subtotal
            invoiceData.subtotal = invoiceData.items.reduce((sum, item) => sum + item.amount, 0);
            
            // Calculate tax amounts
            invoiceData.sgstAmount = (invoiceData.subtotal * invoiceData.sgstRate) / 100;
            invoiceData.cgstAmount = (invoiceData.subtotal * invoiceData.cgstRate) / 100;
            
            // Calculate total tax
            invoiceData.totalTax = invoiceData.sgstAmount + invoiceData.cgstAmount;
            
            // Calculate total
            invoiceData.total = invoiceData.subtotal + invoiceData.totalTax;
            
            // Update UI
            document.getElementById('subtotal').textContent = `₹${invoiceData.subtotal.toFixed(2)}`;
            document.getElementById('sgstAmount').textContent = `₹${invoiceData.sgstAmount.toFixed(2)}`;
            document.getElementById('cgstAmount').textContent = `₹${invoiceData.cgstAmount.toFixed(2)}`;
            document.getElementById('totalTax').textContent = `₹${invoiceData.totalTax.toFixed(2)}`;
            document.getElementById('total').textContent = `₹${invoiceData.total.toFixed(2)}`;
        }
        
        // Clear form and reset to original values
        function clearForm() {
            if (!confirm('Are you sure you want to clear the form? All current data will be lost.')) {
                return;
            }
            
            // Reset form fields to original values
            document.getElementById('fromName').value = originalValues.fromName;
            document.getElementById('fromEmail').value = originalValues.fromEmail;
            document.getElementById('fromMobile').value = originalValues.fromMobile;
            document.getElementById('fromAddress').value = originalValues.fromAddress;
            document.getElementById('toName').value = originalValues.toName;
            document.getElementById('toEmail').value = originalValues.toEmail;
            document.getElementById('toMobile').value = originalValues.toMobile;
            document.getElementById('toAddress').value = originalValues.toAddress;
            document.getElementById('notes').value = originalValues.notes;
            document.getElementById('sgstRate').value = originalValues.sgstRate;
            document.getElementById('cgstRate').value = originalValues.cgstRate;
            
            // Generate new invoice number and dates
            const now = new Date();
            const dueDate = new Date(now.getTime() + 30 * 24 * 60 * 60 * 1000);
            document.getElementById('invoiceNumber').value = `INV-${now.getFullYear()}-${String(Math.floor(1000 + Math.random() * 9000))}`;
            document.getElementById('issueDate').value = now.toISOString().split('T')[0];
            document.getElementById('dueDate').value = dueDate.toISOString().split('T')[0];
            
            // Clear items and add original items
            document.getElementById('itemsTableBody').innerHTML = '';
            invoiceData.items = [];
            
            originalValues.items.forEach(item => {
                addNewItem(item.description, item.quantity, item.price);
            });
            
            // Recalculate invoice
            calculateInvoice();
            
            // Show confirmation
            alert('Form has been cleared and reset to original values.');
        }
        
        // Attach event listeners to items
        function attachItemEventListeners() {
            // Item input changes
            document.querySelectorAll('.item-input').forEach(input => {
                input.addEventListener('input', function() {
                    const itemId = this.getAttribute('data-id');
                    const field = this.getAttribute('data-field');
                    updateItem(itemId, field, this.value);
                });
            });
            
            // Delete item buttons
            document.querySelectorAll('.delete-item-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const itemId = this.getAttribute('data-id');
                    deleteItem(itemId);
                });
            });
        }
        
        // Tax rate changes
        document.getElementById('sgstRate').addEventListener('input', calculateInvoice);
        document.getElementById('cgstRate').addEventListener('input', calculateInvoice);
        
        // Add item button
        document.getElementById('addItemBtn').addEventListener('click', function() {
            addNewItem();
        });
        
        // Print button
        document.getElementById('printBtn').addEventListener('click', function() {
            window.print();
        });
        
        // Download as PDF button
        document.getElementById('downloadBtn').addEventListener('click', function() {
            // Use html2canvas and jsPDF to generate PDF
            const { jsPDF } = window.jspdf;
            
            // Create a clone of the invoice content for PDF generation
            const invoiceElement = document.querySelector('.invoice-content');
            const clone = invoiceElement.cloneNode(true);
            
            // Remove buttons and other non-essential elements from the clone
            clone.querySelectorAll('.no-print').forEach(el => el.remove());
            
            // Make background white for PDF
            clone.style.backgroundColor = 'white';
            clone.style.color = 'black';
            clone.querySelectorAll('input, textarea').forEach(el => {
                el.style.backgroundColor = 'transparent';
                el.style.color = 'black';
                el.style.border = '1px solid black';
            });
            clone.querySelectorAll('.item-amount').forEach(el => {
                el.style.backgroundColor = 'transparent';
                el.style.border = '1px solid black';
            });
            
            // Append clone to body temporarily
            clone.style.position = 'absolute';
            clone.style.left = '-9999px';
            document.body.appendChild(clone);
            
            html2canvas(clone, {
                scale: 2,
                backgroundColor: '#ffffff'
            }).then(canvas => {
                // Remove the clone
                document.body.removeChild(clone);
                
                const imgData = canvas.toDataURL('image/png');
                const pdf = new jsPDF('p', 'mm', 'a4');
                const imgProps = pdf.getImageProperties(imgData);
                const pdfWidth = pdf.internal.pageSize.getWidth();
                const pdfHeight = (imgProps.height * pdfWidth) / imgProps.width;
                
                pdf.addImage(imgData, 'PNG', 0, 0, pdfWidth, pdfHeight);
                pdf.save(`invoice-${document.getElementById('invoiceNumber').value}.pdf`);
            });
        });
        
        // Save button
        document.getElementById('saveBtn').addEventListener('click', function() {
            // Collect all data
            const invoiceDataToSave = {
                invoiceNumber: document.getElementById('invoiceNumber').value,
                issueDate: document.getElementById('issueDate').value,
                dueDate: document.getElementById('dueDate').value,
                fromName: document.getElementById('fromName').value,
                fromEmail: document.getElementById('fromEmail').value,
                fromMobile: document.getElementById('fromMobile').value,
                fromAddress: document.getElementById('fromAddress').value,
                toName: document.getElementById('toName').value,
                toEmail: document.getElementById('toEmail').value,
                toMobile: document.getElementById('toMobile').value,
                toAddress: document.getElementById('toAddress').value,
                items: invoiceData.items,
                notes: document.getElementById('notes').value,
                sgstRate: invoiceData.sgstRate,
                cgstRate: invoiceData.cgstRate,
                sgstAmount: invoiceData.sgstAmount,
                cgstAmount: invoiceData.cgstAmount,
                totalTax: invoiceData.totalTax,
                subtotal: invoiceData.subtotal,
                total: invoiceData.total
            };
            
            // Save to localStorage
            localStorage.setItem('invoiceData', JSON.stringify(invoiceDataToSave));
            
            // Show confirmation
            alert('Invoice saved successfully!');
        });
        
        // Clear form button
        document.getElementById('clearBtn').addEventListener('click', clearForm);
        
        // Load saved data if available
        const savedData = localStorage.getItem('invoiceData');
        if (savedData) {
            const parsedData = JSON.parse(savedData);
            
            // Populate form fields
            document.getElementById('invoiceNumber').value = parsedData.invoiceNumber || '';
            document.getElementById('issueDate').value = parsedData.issueDate || '';
            document.getElementById('dueDate').value = parsedData.dueDate || '';
            document.getElementById('fromName').value = parsedData.fromName || '';
            document.getElementById('fromEmail').value = parsedData.fromEmail || '';
            document.getElementById('fromMobile').value = parsedData.fromMobile || '';
            document.getElementById('fromAddress').value = parsedData.fromAddress || '';
            document.getElementById('toName').value = parsedData.toName || '';
            document.getElementById('toEmail').value = parsedData.toEmail || '';
            document.getElementById('toMobile').value = parsedData.toMobile || '';
            document.getElementById('toAddress').value = parsedData.toAddress || '';
            document.getElementById('notes').value = parsedData.notes || '';
            document.getElementById('sgstRate').value = parsedData.sgstRate || 9;
            document.getElementById('cgstRate').value = parsedData.cgstRate || 9;
            
            // Load items if available
            if (parsedData.items && parsedData.items.length > 0) {
                // Clear existing items
                document.getElementById('itemsTableBody').innerHTML = '';
                invoiceData.items = [];
                
                // Add saved items
                parsedData.items.forEach(item => {
                    addNewItem(item.description, item.quantity, item.price);
                });
                
                // Calculate invoice with saved values
                calculateInvoice();
            }
        }
    </script>
</body>
</html>